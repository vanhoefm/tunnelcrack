<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="no-js">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>TunnelCrack: Widespread design flaws in VPN clients</title>
	<meta name="keywords" content="TunnelCrack, Bypass, Routing, VPN, WireGuard, OpenVPN, IPsec, Leak, Plaintext, Intercept, Tunnel, PPTP, L2TP, Mathy, Vanhoef" />
	<meta name="description" content="We present two widespread design flaws in VPN client. These can be abused to make a victim leak traffic in plaintext outside the protected VPN tunnel." />
	<link href="css/default.css" rel="stylesheet" type="text/css" media="all" />

	<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
	<link rel="icon" href="images/favicon.ico" type="image/x-icon">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/modernizr.min.js"></script>
	<!--[if lt IE 9]>
	<script src="js/respond.src.js"></script>
	<![endif]-->
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-VF51RERBYW"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-5TM4JZ8KCY');
	</script>
</head>
<body>
<div id="wrapper">
	<div id="header-wrapper">
		<div id="header" class="container">
			<div id="logo">
				<img src="images/logo.png" width="100%"/>
			</div>
			<div id="madeby">
				<h3>by <a href="https://distrinet.cs.kuleuven.be/">KU Leuven</a>, <a href="https://cyber.nyu.edu/">NYU</a>, and <a href="https://nyuad.nyu.edu/en/research/faculty-labs-and-projects/nyuad-ccs.html">NYU Abu Dhabi</a>
			</h3>
			</div>
		</div>
	</div>
	<div id="menu-wrapper">
		<div id="main-nav" class="container">
			<span class="custom-mobile-menu-title" style="display: none;">Navigate page</span>
			<ul class="menu">
				<li class="page_item"><a href="#intro">Intro</a></li>
				<li class="page_item"><a href="#demo">Demo</a></li>
				<li class="page_item"><a href="#details">Details</a></li>
				<li class="page_item"><a href="#paper">Paper</a></li>
				<li class="page_item"><a href="#tools">Tools</a></li>
				<li class="page_item"><a href="#faq">Q&amp;A</a></li>
			</ul>
		</div>
	</div>
	<div id="page" class="container">
	<div id="content">
		<!-------------------- INTRO -------------------->

		<h2 class="firsttitle"><a name="intro" href="#intro">Introduction</a></h2>

		<p>
		<span title="Leuven, Belgium, 8 August 2023 at 17:00 CEST">8 August 2023</span> &mdash;
		This website presents TunnelCrack, a combination of two widespread security vulnerabilities
		in VPNs.
		Although a VPN is supposed to protect all data that a user transmits,
		our attacks can bypass the protection of a VPN.
		For instance, an adversary can abuse our vulnerabilities to leak and read user traffic, steal user
		information, or attack user devices.
		Our tests indicate that <strong>every VPN product is vulnerable on at least one device</strong>.
		<!-- Note: Linux is 33% for LocalNet yet seems more affected by ServerIP, hence we still group it with Windows and say majority of. Android rarely affected by ServerIP. -->
		We found that VPNs for iPhones, iPads, MacBooks, and macOS are extremely likely to be vulnerable, that a majority of VPNs on Windows and Linux are vulnerable, and that Android is the most secure with roughly one-quarter of VPN apps being vulnerable.
		</p>

		<p>
		The discovered vulnerabilities can be abused regardless of the security protocol used by the VPN.
		In other words, even VPNs that claim they use "military grade encryption" or that use self-developed encryption
		protocols can be attacked.
		The root cause of both vulnerabilities has been part of VPNs since their first creation around 1996.
		This means that our <strong>vulnerabilities went unnoticed, at least publicly, for more than two decades</strong>.
		</p>

		<p>
		Our first set of vulnerabilities, called LocalNet attacks, can be exploited when a user connects to an
		untrusted Wi-Fi network. Our second set of vulnerabilities, called ServerIP attacks, can be exploited
		by untrusted Wi-Fi networks <i>and</i> by malicious Internet service providers.
		Both attacks manipulate the victim's routing table to <strong>trick the victim into
		sending traffic outside the protected VPN tunnel</strong>, allowing an adversary to read and intercept
		transmitted traffic.
		</p>

		<p>
		To protect users, security updates were prepared during a 90-days coordinated disclosure in collaboration
		with CERT/CC and various VPN vendors.
		<!-- TODO: Recheck that they indeed put online updated VPNs, if not already done... -->
		Some example patched VPNs are
		<a href="https://www.mozilla.org/en-US/products/vpn/">Mozilla VPN</a>,
		<a href="https://surfshark.com/">Surfshark</a>,
		<a href="https://www.malwarebytes.com/vpn">Malwarebytes</a>,
		<a href="https://windscribe.com/">Windscribe</a> (can import OpenVPN profiles),
		and <a href="https://1.1.1.1/">Cloudflare's WARP</a>.
		<!-- TODO:  (see <a href="#patchedvpns">full list</a>) -->
		If updates for
		your VPN are not available, you can mitigate the LocalNet attack by disabling local network access.
		You can also mitigate attacks by assuring websites use HTTPS, which many websites nowadays support.
		</p>

		<p>
		Our research will be presented at the <a href="#usenixpres">USENIX Security</a>
		conference on 11 August 2023. The research was carried out by Nian Xue (New York University), Yashaswi Malla,
		Zihang Xia, Christina Pöpper (New York University Abu Dhabi), and Mathy Vanhoef (KU Leuven University).
		You can contact <a href="#contact">Mathy Vanhoef</a> for any questions.
		</p>

		<!-------------------- DEMO -------------------->

		<h2><a name="demo" href="#demo">Demo</a></h2>

		<p>
		The video below shows three examples of how an adversary can abuse the discovered vulnerabilities.
		First, the LocalNet attack is abused to make the victim leak traffic. This is used to intercept sensitive info sent to insecure websites, e.g., the victim's username and password is leaked.
		We also show how an adversary can identify which websites someone is visiting, which is normally not possible when using a VPN.
		Finally, a variant of the LocalNet attack is abused to block a security camera from notifying the user of unexpected movements.
		</p>
		<div class="demo-video">
		<div class="demo-video-container">
			<iframe width="560" height="315" src="https://www.youtube.com/embed/vOawEz39yNY?rel=0&amp;vq=hd720" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
		</div>
		</div>
		<p>
		As the demo illustrates, the VPN flaws can be abused to trivially leak traffic and
		identify the websites that someone is visiting. Additionally, any data sent to improperly configured websites, or sent by insecure apps, can be intercepted.
		</p>
		<p>
		Users can defend themselves by updating their VPN software. Additionally, when a website is properly configured with
		<a href="https://www.eff.org/deeplinks/2014/02/websites-hsts">HSTS</a> to always
		use <a href="https://en.wikipedia.org/wiki/HTTPS">HTTPS</a> as an extra layer of security, which nowadays around
		<a href="https://w3techs.com/technologies/details/ce-hsts">25%</a> of websites are,
		any transmitted data cannot be stolen.
		Moreover, several browsers now <a href="https://www.blog.google/products/chrome/milestone-chrome-security-marking-http-not-secure">warn</a>
		the user when HTTPS is not being used.
		Finally, although <a href="https://www.usenix.org/conference/usenixsecurity21/presentation/oltrogge">not always</a> perfect,
		modern mobile apps by default use HTTPS and therefore also use this extra protection.
		</p>
		<p>
		Apart from targeting websites, another risk is that VPNs are often used to protect older or insecure protocols.
		Our attacks now enable an adversary to remove the protection offered by a VPN, meaning adversaries can subsequently attack
		any older or insecure protocols used by the victim, such as RDP, POP, FTP, telnet, and so on.
		</p>


		<!-------------------- DETAILS -------------------->

		<h2><a name="details" href="#details">Details</a></h2>
		
		<!--
		<h3><a name="presentations" href="#presentations">Presentations</a></h3>

		<p>
		If you don't want to read the following text, you can also watch my recorded <a href="#usenixpres">USENIX Security</a>
		presentation.
		</p>
		-->

		<h3><a name="summary" href="#summary">Background and core idea</a></h3>

		<p>The core idea behind our attacks is to manipulate the VPN client into sending traffic outside the protected VPN tunnel. By doing so, the victim's traffic can be read and intercepted. Under normal conditions, the client’s
		<a href="https://en.wikipedia.org/wiki/Routing_table">routing table</a> assures
		that all traffic will be sent, i.e., routed, through the protected VPN tunnel. However,
		many VPN clients add exceptions to send the following two types of traffic outside the VPN tunnel:
		</p>
		<ol>
			<li>Traffic sent to and from the local network; and</li>
			<li>Traffic sent to and from the VPN server.</li>
		</ol>
		<p>
		The first routing rule assures that the local network remains accessible while using the VPN, meaning the user can enable the VPN
		while simultaneously printing files, performing screen casting to their TV, and so on. The second routing rule assures that
		there is no routing loop, i.e., that already-encrypted VPN packets do not undergo encryption again.
		Unfortunately, we
		discovered that an adversary can manipulate these routing exceptions such that arbitrary traffic will be sent outside the
		VPN tunnel.
		</p>
		<p>
		In our LocalNet attacks, the adversary acts as a malicious Wi-Fi network and pretends that websites and Internet servers are directly reachable in the local Wi-Fi network. This causes traffic leakage due to the "send local traffic outside the VPN tunnel" rule.
		In our ServerIP attacks, an adversary changes, i.e., spoofs, the IP address of the VPN server. This causes traffic leakage due to the "send traffic to the IP address of the VPN server outside the VPN tunnel" rule.
		</p>

		<h3><a name="localnetdetails" href="#localnetdetails" title="CVE-2023-36672 and CVE-2023-35838">LocalNet Attacks</a></h3>
		
		<p>
		In the LocalNet attack, the adversary acts as a malicious Wi-Fi or Ethernet network, and tricks the victim into connecting to this network.
		An easy way to accomplish this is by cloning a popular Wi-Fi hotspot such as "starbucks".
		When a victim connects to this malicious network, the <strong>adversary assigns a public IP address and subnet</strong> to the victim.
		The figure below shows an example of this, where the adversary's goal is to intercept traffic towards the website target.com:</p>
		
		<div id="localnet" class="diagram" ></div>
		
		<p>
		In the above figure, the website target.com has the IP address 1.2.3.4. To intercept traffic to this website, the adversary tells the victim that the local network is using the subnet 1.2.3.0/24. In other words, the victim is informed that IP addresses in the range 1.2.3.1-254 are directly reachable in the local network.
		When the victim now visits target.com, a web request will be sent to the IP address 1.2.3.4.
		Because the victim thinks that this IP address is directly reachable in the local network,
		it will send the web request outside the protected VPN tunnel.</p>
		<p>
		An adversary can also assign larger subnets to the local network to leak nearly all of the victim's traffic.
		Additionally, although the main goal of the LocalNet attack is to leak traffic outside the VPN tunnel,
		the attack can also be abused to block selected traffic while the VPN is being used (see <a href="#paper">our paper</a> for details) .
		</p>
		
		<!-- Summary of affected apps and OSs -->
		<p>
		We tested more than 66 VPN apps on five platforms and found that <strong>all VPN apps on iOS are vulnerable</strong>.
		Additionally, all but one VPN client on macOS is vulnerable, on Windows a large majority of VPNs are vulnerably, and on Linux more than one-third are vulnerable. Interestingly, <strong>VPN apps on Android are typically the most secure</strong>, with one-quarter being vulnerable to the LocalNet attack. We conjecture that this is because Android has a more carefully designed API to create VPN apps.
		</p>

		<div id="localnetstats" class="diagram" ></div>

		<p>
		To defend against the attack, the VPN app should automatically disable local network access when the local network is using public IP addresses.
		On most platforms this can be easily implemented.
		On iOS this can be done by using the includeAllNetworks and excludeLocalNetworks APIs.
		Some vendors reported reliability issues when using these APIs, making some them hesitant to adopt this defense.
		Ideally, Apple should create a more robust API for VPNs on iOS, or implement a more secure behaviour by default,
		so that VPN apps can be implemented more securely without needing knowledge of these API parameters.
		</p>

		<h3><a name="serveripdetails" href="#serveripdetails" title="CVE-2023-36673 and CVE-2023-36671">ServerIP Attacks</a></h3>

		<p>
		In the ServerIP attacks, the attacker must be able to spoof DNS replies before the VPN is enabled,
		and must be able to see traffic to the VPN server. Similar to the LocalNet attacks, this can be
		accomplished by acting as a malicious Wi-Fi or Ethernet network. The attacks can also be carried out by
		a malicious ISP or compromised core Internet router.
		<p>

		<p>
		The core idea is that the <strong>adversary spoofs the IP address of the VPN server</strong>.
		For example, if the VPN server is identified by the hostname vpn.com and its real IP address is 2.2.2.2, then the
		adversary can spoof the DNS response to have a different IP address. The following figure shows an example of this,
		where the adversary's goal is to intercept traffic towards target.com which has the IP address 1.2.3.4:
		</p>
		
		<div id="serverip" class="diagram" ></div>

		<p>
		The adversary first spoofs the DNS reply for vpn.com to return the IP address 1.2.3.4, which equals the IP address
		of target.com. In other words, we spoof the IP address that we want to leak traffic towards. The victim will then
		connect with the VPN server at 1.2.3.4. To assure the victim still
		successfully creates a VPN connection, the adversary redirects this traffic to the real VPN server.
		As a result, even though the victim is using the wrong IP address for the VPN server, the VPN tunnel is still
		successfully created. Moreover, the victim will add a routing rule so that all traffic to 1.2.3.4 is sent
		outside the VPN tunnel.
		</p>

		<p>
		When the victim now visits target.com, a web request is sent to 1.2.3.4. Due to the routing rule to
		prevent re-encryption of packets to the VPN server, this request is sent outside the
		protected VPN tunnel. As a result, the web request is leaked.
		</p>

		<p>
		We found that the built-in VPN clients of Windows, macOS, and iOS are vulnerable. Android 12 and higher is not affected.
		A significant number of Linux VPNs are also vulnerable. Additionally, we found that most OpenVPN profiles, when used
		with a vulnerable VPN client, use a hostname to identify the VPN server and therefore may result in vulnerable behavior.
		For more details about the ServerIP experiments, see <a href="#paper">our paper</a>.
		To prevent the attack, VPN clients should be updated to send all traffic through the VPN tunnel, except traffic
		generated by the VPN app itself.
		</p>

		<h3><a name="discussion" href="#discussion">Discussion</a></h3>

		<!-- TODO: Simplify the words? -->
		<p>
		Our attacks are not computationally expensive, meaning anyone with the appropriate network access can perform
		them, and they are independent of the VPN protocol being used. Overall, our attacks break the security and anonymity
		that VPNs are expected to provide. Even if the victim is using another layer of encryption such as HTTPS, our attacks reveal
		which websites a user is visiting, which can be a significant privacy risk. Moreover, the leaked traffic can contain
		sensitive data if older insecure protocols are used, and our attack can be used as a basis to attack such older protocols.
		</p>

		<!-- TODO: Avoid repitition -->
		<p>
		We believe that one reason why these routing manipulation vulnerabilities were only discovered more than two decades
		after the introduction of VPNs, is that most previous works focused on the VPN protocols themselves, but only few studied
		their integration into real-world clients and platforms. In other words, our attacks show that properly integrating VPNs
		into a platform, and securely managing the routing table, is essential for security.
		</p>

		<p>
		Our results also show that the security of VPN clients practically always depends on the Operating System (OS), meaning one
		must always take into account the OS when discussing the security of a VPN product or brand. We also believe that the OS should
		provide a straightforward and secure API to configure and start VPN clients. This avoids each VPN having to implement its
		own or routing table code on each supported OS, which should increase overall security. For instance, Android has one
		of the more robust APIs to enable a VPN, and this is one explanation why VPN clients are typically more secure on Android.
		</p>
		
		<!-------------------- CVEs -------------------->

		<h3><a name="cves" href="#cves">Assigned CVE identifiers</a></h3>

		<p>
		Our findings were tracked by CERT/CC under the identifier <a href="https://www.kb.cert.org/vuls/id/563667">VU#563667</a>.
		Our attacks got assigned the following Common Vulnerabilities and Exposures (CVE) identifiers:
                </p>
		<ul>
			<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-36672">CVE-2023-36672</a>: LocalNet attack resulting in leakage of traffic in plaintext. The reference CVSS score is <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N&version=3.1">6.8</a>.</li>
			<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-35838">CVE-2023-35838</a>: LocalNet attack resulting in the blocking of traffic. The reference CVSS score is <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:L&version=3.1">3.1</a>.</li>
			<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-36673">CVE-2023-36673</a>: ServerIP attack, combined with DNS spoofing, that can leak traffic to arbitrary IP address. The reference CVSS score is <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N&version=3.1">7.4</a>.</li>
			<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-36671">CVE-2023-36671</a>: ServerIP attack where only traffic to the real IP address of the VPN server can be leaked. The reference CVSS score is <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:N/A:N&version=3.1">3.1</a>.</li>
		</ul>

		<p>
		Note that these are reference CVE identifiers.
		Normally each affected codebase receives a unique CVE,
		but the agreement between affected vendors was that, in this specific case,
		using the same CVE across different codebases would make communication easier.
		For instance, by tying one CVE to each vulnerability, a customer can now ask a vendor
		whether their product is affected by a specific CVE.
		<!-- Using a unique CVE for each codebase would complicate such questions and cause confusion. -->
		Please note that this deviates from normal MITRE guidelines, and that this decision was made
		by affected vendors independently of MITRE, and that this in no way reflects any changes
		in how MITRE assigns CVEs.
		</p>

		<!-------------------- PAPER -------------------->
		
		<h2><a name="paper" href="#paper">Paper</a></h2>
		
		<p>
		Our paper behind the attack is titled
		<a href="https://papers.mathyvanhoef.com/usenix2023-tunnelcrack.pdf">Bypassing Tunnels: Leaking VPN Client Traffic by Abusing Routing Tables</a>
		and will be presented at <a href="https://www.usenix.org/conference/usenixsecurity23/presentation/xue">USENIX Security</a>.
		You can use the following bibtex entry to cite our paper:</p>
		<div class="indent">
			<pre class="code">@inproceedings{usenix2023-tunnelcrack,
  author = {Nian Xue and Yashaswi Malla and Zihang Xia and Christina P\"opper and Mathy Vanhoef},
  title = {Bypassing Tunnels: Leaking {VPN} Client Traffic by Abusing Routing Tables},
  booktitle = {Proceedings of the 32th {USENIX} Security Symposium},
  year = {2023},
  month = {August},
  publisher = {{USENIX} Association}
}</pre>
		</div>

		<h3><a name="papernotes" href="#papernotes">Paper Clarifications</a></h3>

		<ul>
			<li>Table 1 (Appendix): during our tests Mullvad on Android was always secure against the LocalNet attack, no matter what the LAN setting was, and should therefore have a green checkmark. </li>
			<li>In Section 5.6.5 regarding Cisco AnyConnect, during the disclosure we were only able to replicate the leakage of packets on port 443. There were no observed leaks on other ports.</li>
			<li>In Section 6.1.1 regarding defenses to the LocalNet attack, with "Disable local traffic" we don't mean blocking traffic. We mean that traffic to local IP addresses should also be sent through the VPN tunnel.</li>
			<!-- TODO: Mark-down style code listing? -->
			<li>In Section 5.4.2 regarding defenses to the LocalNet attack on iOS, before our disclosure only a few vendors used the includeAllNetworks and excludeLocalNetworks API parameters. During the disclosure we recommended usage of the includeAllNetworks parameter to prevent the attack. We remark that the parameter excludeLocalNetworks only has an effect when includeAllNetworks is to True.</li>
		</ul>

		<h3><a name="usenixpres" href="#usenixpres">Presentations</a></h3>
		
		<p>
		The recorded presentation made for USENIX Security can now be viewed online. Note that the target audience
		of this presentation are academics and IT professionals:
		</p>

		<div class="demo-video">
		<div class="demo-video-container">
			<iframe width="560" height="315" src="https://www.youtube.com/embed/jPa-V4giAGI?rel=0&amp;vq=hd720" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
		</div>
		</div>

		<p>
		The longer Black Hat Europe talk can also be viewed online:
		</p>

		<div class="demo-video">
		<div class="demo-video-container">
			<iframe width="560" height="315" src="https://www.youtube.com/embed/Gbt7aEANIEE?rel=0&amp;vq=hd720" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
		</div>
		</div>

		<!--
		<h3><a name="extradocs" href="#extadocs">Extra Documents</a></h3>
		<ul>
			<li>Paper artifact?</li>
			<li>Slides?</li>.
		</ul>
		-->

		<!-------------------- Tools -------------------->

		<h2><a name="tools" href="#tools">Tools</a></h2>
		<p>
		Our <a href="https://github.com/vanhoefm/vpnleaks">GitHub repository</a> contains instructions on how to
		manually test VPN clients. These are the instructions that we also followed while carrying out the research.
		During the coordinated disclosure, we also made a more automated script to test VPNs, as can be seen in the
		demo. However, to prevent malicious individuals from abusing our testing script to attack users, we will
		only release this script once sufficiently many VPNs have been patched.
		</p>

		<p>
		The LocalNet attack can be easily tested though: configure a router to
		use the subnet 216.165.47.0/24 for the local network. Connect to the router, enable the VPN,
		and visit http://nyu.edu or http://216.165.47.10. If, while the VPN is enabled, the NYU website won't load
		using one of these URLs, then the VPN is likely vulnerable.
		</p>

		<!-- TODO: Markdown style for commands? -->
		<p>
		A quick method to confirm that a VPN client <i>cannot</i> be vulnerable to the ServerIP attack is to enable
		the VPN and then use Wireshark to identify the VPN server's IP address. Then visit http://$VPN_SERVERIP. If you cannot
		see plaintext TCP SYNs in Wireshark (use the filter "tcp.flags.syn == 1") then the VPN client cannot be vulnerable.
		</p>

		<!-------------------- Q&A -------------------->

		<h2><a name="faq" href="#faq">Q&amp;A</a></h2>

		<p><i>Note: we are still tweaking the Q&A during the initial hours of the disclosure.</i></p>

		<ul>
			<li><a href="#contact">How can I contact you?</a></li>
			<li><a href="#howfound">How did you discover this?</a></li>
			<li><a href="#images">Can I reuse the images on this website?</a></li>
			<li><a href="#openvpnclient">Which OpenVPN-capable clients have patched the vulnerabilities?</a></li>
			<li><a href="#bhdefcon">Why is the disclosure so close to Black Hat and DEF CON?</a></li>
			<li><a href="#clariovpn">Was ClarioVPN informed of the vulnerabilities?</a></li>
			<li><a href="#ivanti">Was Ivanti informed of the vulnerabilities?</a></li>
			<li><a href="#windows">Is Window's built-in VPN also vulnerable?</a></li>
			<li><a href="#notnoticed">Why did nobody notice these vulnerabilities before?</a></li>
			<li><a href="#notpatched">My VPN client isn't patched yet, what can I do?</a></li>
			<li><a href="#whyimportant">Why is a VPN still important? These days we can rely on HTTPS.</a></li>
			<li><a href="#allaffected">How sure are you that every VPN is vulnerable on at least one device?</a></li>
			<li><a href="#abusetools">Isn't it irresponsible to release tools to perform the attacks?</a></li>
			<li><a href="#attacktools">Where are all the attack tools?</a></li>
			<li><a href="#ioslocalnet">Why is the LocalNet attack so hard to fix on iOS?</a></li>
			<li><a href="#demoblock">How did you block selected traffic in the demo?</a></li>
			<li><a href="#localnetmany">Why are so many implementations vulnerable to the LocalNet attack?</a></li>
			<li><a href="#samecves">Why do you use the same CVE for implementation issues in multiple different codebases?</a></li>
			<li><a href="#hownotified">Why were not all VPN vendors notified in advance?</a></li>
			<li><a href="#beingexploit">Are these vulnerabilities being exploited in practice?</a></li>
			<li><a href="#silentupdates">Why did some VPN vendors silently release fixes before the disclosure?</a></li>
			<li><a href="#nyuhsts">Isn't nyu.edu using HSTS to prevent these kinds of attacks?</a></li>
		</ul>

		<!--
		TODO:
		* OpenVPN response.
		* Custom mitigation: disable local network access.
		* 
		* Notified VPN companies.
		* Does this relate to the recent Mozilla vulnerability?
		-->

		<h3><a name="contact" href="#contact">How can I contact you?</a></h3>
		<p>
		The research was carried out by Nian Xue (New York University), Yashaswi Malla, Zihang Xia,
		Christina Pöpper (New York University Abu Dhabi), and Mathy Vanhoef (KU Leuven University).
		You can e-mail <a href="mailto:Mathy.Vanhoef@kuleuven.be">Mathy Vanhoef</a> for any questions.
		</p>

		<h3><a name="howfound" href="#howfound">How did you discover this?</a></h3>
		<p>
		The initial research idea came from Mathy Vanhoef. To quote him:
		"I've wanted to study the security of VPN for a while. Around 9 June 2020, so during the midst of COVID,
		I was looking at all the configuration options of OpenVPN for Android. At the time I was living in Abu Dhabi
		and using a VPN was common to get access to my computers in Belgium. While randomly scrolling through the
		options, I saw the option "Bypass VPN for local networks". Enabling that option allowed you to directly connect
		to devices in the local network without going through the VPN. At that moment I realised that some VPN clients
		might not check	whether the local network is using private IP address. And I realized that an adversary would
		then be able to create a rogue Wi-Fi network that advertises public IP address and would then be able to intercept
		traffic. I was able to quickly confirm this against my own VPN client. After this initial experiment, we first had
		to finished other research, and it took a while before our team could devote our full attention towards VPN research."
		</p>

		<h3><a name="images" href="#images">Can I reuse the images on this website?</a></h3>
		<p>
		<!-- TODO -->
		Yes. For instance, you can use the <a href="images/logo.png">logo</a>, illustrations of the <a href="images/localnet.png">LocalNet</a>
		attack (<a href="images/localnet_small.png">mobile version</a>),
		illustrations of the <a href="images/serverip.png">ServerIP</a> attack (<a href="images/serverip_small.png">mobile version</a>),
		and statistics of the <a href="images/localnetstats.png">LocalNet experiments</a> (<a href="images/localnetstats_small.png">mobile version</a>).
		</p>
		<p>
		Thanks goes to <a href="https://www.thehappylee.com/graphic-design-projects">Darlee Urbiztondo</a> for designing the logo.
		</p>

		<h3><a name="openvpnclient" href="#openvpnclient">Which OpenVPN-capable clients have patched the vulnerabilities?</a></h3>
		<p>
		In case you use OpenVPN servers and profiles, then you can use the open-source <a href="https://windscribe.com/">Windscribe</a>
		client and load your OpenVPN profile in Windscribe. You will then be able to use Windscribe with your own server. At the time of
		disclosure, the Windscribe client was secure against all attacks on all the platforms that we tested (Windows, Android,
		macOS, Linux, iOS).
		In contrast, during the disclosure we were not aware of any updates that the OpenVPN Connect client had planned,
		meaning we don't know to which extent OpenVPN Connect will prevent our attacks.
		</p>

		<h3><a name="bhdefcon" href="#bhdefcon">Why is the disclosure so close to Black Hat and DEF CON?</a></h3>
		<p>
		The research was accepted at USENIX Security. We decided to disclose our research on the
		<a href="https://en.wikipedia.org/wiki/Patch_Tuesday">Patch Tuesday</a>
		before the start of USENIX Security, which turned out to be Tuesday 8 August 2023. 
		</p>
		<p>
		I only realized while making this website that people will likely be relying on VPNs during
		Black Hat and DEF CON (and the other security conferences). And given the large amount of VPN clients that exist,
		it might be unclear whether your specific VPN client is already patched and secure.. #oops.
		</p>


		<h3><a name="clariovpn" href="#clariovpn">Was ClarioVPN informed of the vulnerabilities?</a></h3>
		<p>
		Yes. The Dubai-based ClarioVPN team was notified about both attacks. The summarized disclosure timeline was:
		</p>
		<ul>
			<li>15 April 2023: Initial report about a ServerIP attack variant sent to Clario.</li>
			<li>5 May 2023: After some discussion, they informed us that MitM attacks are out of scope.</li>
			<li>8 May 2023: Mathy Vanhoef publicly <a href="https://twitter.com/vanhoefm/status/1655769309707370498">tweeted</a> that Clario considers MitM attacks against a VPN to be out of scope.</li>
			<li>12 May 2023: Clario changed the scope of their vulnerability program and now does consider MitM to be in scope for its VPN client. They will forward the report to the appropriate team for review.</li>
			<li>15 May 2023: Initial report about LocalNet attacks sent to Clario.</li>
			<li>7 June 2023: They informed us that the LocalNet attack doesn’t seem to have any significant security risk and/or security impact. Clario mentioned that they aren't interested in participating in this "multi-party coordinated disclosure on VPN security".</li>
			<li>7 June 2023: Informed them that ClarioVPN will be part of the disclosure.</li>
			<li>21 July 2023: Clario informed us that there appeared to be a miscommunication. They believe the risk to their customers is not low, but medium, and that they are nevertheless going to release fixes.</li>
		</ul>
		<p>
		Note that Mathy Vanhoef handled the disclosure with Clario. Based on his experience, and their reaction,
		he doesn't consider ClarioVPN to be a trustworthy VPN.
		</p>

		<h3><a name="ivanti" href="#ivanti">Was Ivanti informed of the vulnerabilities?</a></h3>
		<p>
		Yes.
		</p>

		<h3><a name="windows" href="#windows">Is Window's built-in VPN also vulnerable?</a></h3>
		<p>
		Yes, it's vulnerable to both the LocalNet and ServerIP attacks. Microsoft is not planning to release patches.
		</p>
		<p>
		The disclosure timeline for the ServerIP attack was:
		</p>
		<ul>
			<li>8 May 2023: Initial report send to Microsoft.</li>
			<li>14 July 2023: They asked if our research would be presented at Black Hat. We informed then that both the ServerIP and LocalNet attacks will be presented at USENIX Security.</li>
			<li>7 August 2023: Microsoft informed us this behavior is by design, the barrier-to-entry to mount this attack is high. Microsoft claims that after the VPN tunnel is established, a MitM won't be able to decapsulate content (while in our opinion the attack is about making the victim leak traffic, not the 'decapsulation' of encrypted traffic). They also mentioned that with a forced tunnel such an attack is not possible because DNS is then also tunneled (in our attack DNS is spoofed before the tunnel is established). It's mentioned that traffic will only leak when using a split-tunnel configuration (while our ServerIP attack can also make a full tunnel VPN leak traffic). It's also mentioned that the attack makes the assumption that TLS-based DNS protocols are not in use (by default they were never used by the Windows platforms that we tested). They mentioned this case will be closed.</li>
			<li>7 August 2023: We briefly replied that they seemed to have misunderstood the attack.</li>
			<li>8 August 2023: Public disclosure as planned.</li>
		</ul>
		<p>
		The disclosure timeline for the LocalNet attack was:
		</p>
		<ul>
			<li>11 May 2023: Initial report send to Microsoft.</li>
			<li>7 August 2023: Microsoft answered that this doesn't meet the bar for an immediate and urgent fix in an upcoming Security Patch update. It's mentioned that if an attacker can hand out "rogue IP addresses" to clients, then network connectivity would be highly likely be broken on the client anyway. They mentioned that therefore, the attack scenario is similar to the ServerIP attacks, where attacks are only possible in a split-tunnel configuration, which they mention is no different to not having a VPN configured for the targeted address ranges. They mentioned this case will be closed.</li>
			<li>7 August 2023: We briefly replied that they seemed to have misunderstood the attack.</li>
			<li>8 August 2023: Public disclosure as planned.</li>
		</ul>
		<p>
		We consider it unfortunate that their reply came so late. We hope it's still possible to rectify the misunderstandings
		about how the attacks work, or at least to better understand the mismatch between what users expect about a VPN compared
		to the actual provided security guarantees of Window's built-in VPN.
		</p>

		<h3><a name="notnoticed" href="#notnoticed">Why did nobody notice these vulnerabilities before?</a></h3>
		<p>
		We think this is because previous research focused on the cryptographic aspects of VPNs, or focused on detecting
		typically programming vulnerabilities in VPNs, but up until now no attention was given to the secure integration of
		VPNs into a real-world system.
		</p>

		<p>
		Note that in 2015, Andrew Ayer wrote the guide <a href="https://www.agwa.name/blog/post/hardening_openvpn_for_def_con">Hardening OpenVPN for DEF CON</a>
		which hinted at the LocalNet attack. Following the guide would prevent the LocalNet attack, at least on Linux. However,
		the ServerIP attack would still be possible when using domain names. Additionally, the guide did not test any existing
		VPN clients, meaning it was unknown whether VPN clients were affected by the LocalNet attack. In our research, where we
		tested around 248 VPN clients, we found that a large number of them were (still) vulnerable, and we notified a large number
		of affected parties to ensure that their VPN clients will defend against the attack.
		</p>

		<h3><a name="notpatched" href="#notpatched">My VPN client isn't patched yet, what can I do?</a></h3>
		<p>
		First, it's always good to remember general security best practices: update your devices, don't reuse your passwords,
		make sure you have backups of important data, don't visit shady websites, and so on.
		</p>
		<p>
		In regard to the discovered VPN vulnerabilities, you can mitigate the LocalNet attack by disabling "local network access"
		in your VPN client. Unfortunately, not all VPN clients offer such a feature.
		<!-- TODO
		 that exfiltrate sensitive data by
		double-checking that websites you are visiting
		<a href="https://www.blog.google/products/chrome/milestone-chrome-security-marking-http-not-secure">use HTTPS</a>.
		Even better, you can install the <a href="https://www.eff.org/https-everywhere">HTTPS Everywhere</a> plugin. This plugin
		forces the usage of HTTPS on websites that are known to support it.
		-->
		</p>

		<h3><a name="whyimportant" href="#whyimportant">Why is a VPN still important? These days we can rely on HTTPS.</a></h3>
		<!-- TODO -->
		<p>
		These days a lot of websites and apps use <a href="https://en.wikipedia.org/wiki/HTTPS">HTTPS</a> to encrypt data.
		When using HTTPS, an adversary cannot see the data you are transmitting even when you are connected to an open Wi-Fi network.
		This also means that you can safely use open Wi-Fi hotspots as long as you keep your devices up-to-date and as long as you assure
		that websites are using HTTPS. Unfortunately, not all websites require the usage of HTTPS (i.e. they're not using
		<a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HSTS</a>), meaning they remain
		vulnerable to possible attacks.
		</p>
		<p>
		When only relying on HTTPS, it's also easy for an adversary to determine which websites you visit. There is research
		work that can also determine exactly which webpage you're visiting on an HTTPS website. So although HTTPS protects
		the data that you are transmitting, it does not hide <i>who</i> you are sending it to. And that on its own can be
		sensitive information.
		</p>

		<h3><a name="allaffected" href="#allaffected">How sure are you that every VPN is vulnerable on at least one device?</a></h3>
		<p>
		<!-- TODO -->
		In experiments on more than 75 devices, all of them were vulnerable to one or more of the discovered attacks.
		I'm curious myself whether <em>all</em> devices in the whole world are indeed affected though! To find this out, if you
		find a device that isn't affected by at least one of the discovered vulnerabilities, let me know.
		</p>
		<p>
		Also, if your company provides Wi-Fi devices and you think that your product was not affected by any of the discovered vulnerabilities,
		you can send your product to me. Once I confirmed that it indeed was not affected by any vulnerabilities the name of
		your product and company will be put here! Note that I do need a method to assure that I'm indeed testing a version
		of the product that was available before the disclosure of the vulnerabilities (and that you didn't silently patch
		some vulnerabilities).
		</p>

		<h3><a name="abusetools" href="#abusetools">Isn't it irresponsible to release tools to perform the attacks?</a></h3>
		<p>
		<!-- TODO -->
		The test tool that we released can only be used to test whether a device is vulnerable. It cannot be used
		to perform attacks: an adversary would have to write their own tools for that. This approach enables network
		administrators to test if devices are affected while reducing the chance of someone abusing the released code.
		</p>

		<h3><a name="attacktools" href="#attacktools">Where are all the attack tools?</a></h3>
		<p>
		<!-- TODO -->
		The code that has currently been released focusses on <em>detecting</em> vulnerable implementations. The proof-of-concepts
		scripts that perform actual attacks are not released to provide everyone with more time to implement and deploy patches.
		Once a large enough fraction of devices has been patched, and if deemed necessary and/or beneficial, the attack script
		 will be publicly released as well.
		</p>

		<h3><a name="ioslocalnet" href="#ioslocalnet">Why is the LocalNet attack so hard to fix on iOS?</a></h3>
		<p>
		<!-- TODO -->
		On iOS this can be prevented by using the includeAllNetworks and excludeLocalNetworks APIs.
		Some vendors reported reliability issues when using these APIs, but we were not able to replicate such issues.
		Nevertheless, this made some vendors hesitant to adopt this defense.
		Ideally, Apple should create a more robust API for VPNs on iOS, or implement a more secure behaviour by default,
		so that VPN apps can be implemented more securely without needing knowledge of these API parameters.
		</p>
		
		<h3><a name="demoblock" href="#demoblock">How did you block selected traffic in the demo?</a></h3>
		<p>
		<!-- TODO -->
		By assigning the IP addresses that we wanted to block to the local Wi-Fi network.
		</p>

		<h3><a name="localnetmany" href="#localnetmany">Why are so many implementations vulnerable to the LocalNet attack?</a></h3>
		<p>
		Most users want to be able to access their local network while using a VPN. Unfortunately, we found that this was nearly
		always implemented in an insecure manner.
		</p>

		<h3><a name="samecves" href="#samecves">Why do you use the same CVE for implementation issues in multiple different codebases?</a></h3>
		<p>
		<!-- TODO: Update this -->
		Implementation-specific vulnerabilities usually get their own independent CVE identifier for each different codebase.
		However, because the same implementation issues seem to be present across multiple vendors it would make more sense to have a single CVE identifier
		for each common implementation issue.
		After all, the main purpose of CVE identifiers is to provide a single, common ID to be used across vendors to identify the same vulnerability.
		We therefore think it makes sense to assign only a single CVE identifier to each implementation issues. This enables vendors
		and customers to easily reference an implementation vulnerability and, for instance, check whether certain products are affected
		by one of the discovered vulnerabilities.
		</p>

		<h3><a name="hownotified" href="#hownotified">Why were not all VPN vendors notified in advance?</a></h3>
		<p>
		We collaborated with CERT/CC to disclose our results in a coordinated manner. On top of that, we personally also notified
		VPN vendors that had an explicit security contact and/or a bug bounty program. Unfortunately, it was practically infeasible
		to notify all VPN vendors. Additionally, notifying a large number of VPN vendors increase the risk of the vulnerabilities
		becoming public during the embargo, and increases the risk that malicious actors might learn about the vulnerabilities and
		abuse them in targeted attacks.
		</p>
		<p>
		Based on our previous experience with disclosing Wi-Fi vulnerabilities, it would have been very useful if there would have
		been an equivalent of the Wi-Fi Alliance but for VPN vendors. Such an organization could then help with multi-party coordinated
		disclosures that involve widespread security issues in VPN software.
		</p>

		<h3><a name="beingexploit" href="#beingexploit">Are these vulnerabilities being exploited in practice?</a></h3>
		<p>
		Not that we are aware of. But it is difficult to monitor whether one of the discovered vulnerabilities have
		been exploited in the past or are currently being exploited. So it is hard to give a definite answer to this
		question.
		</p>

		<h3><a name="silentupdates" href="#silentupdates">Why did some VPN vendors silently release fixes before the disclosure?</a></h3>
		<p>
		During the coordinated disclosure, we gave VPN vendors the option to already release fixes roughly two weeks before
		the disclosure, as long as no details of the vulnerability would be made available. Although this creates a risk
		that someone might reverse engineer the patches and rediscover certain attacks, we considered this to be unlikely.
		The vulnerabilities have been present in VPN clients for more than two decades, and the advantage of getting patches
		out on time appeared to outweigh the risk that someone would rediscover the attacks.
		</p>

		<h3><a name="nyuhsts" href="#nyuhsts">Isn't nyu.edu using HSTS to prevent these kinds of attacks?</a></h3>
		<p>
		Websites can use <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HSTS</a> to force browsers to always
		use HTTPS encryption when visiting a website. This prevents the attack that was shown in our <a href="#href">demo</a>.
		Unfortunately, the website of NYU at the time did not properly configure HSTS. More technically, some subdomains such as
		globalhome.nyu.edu do instruct the browser to use HSTS by including the following header in responses:
		</p>
		<div class="indent">
			<pre class="code">strict-transport-security: max-age=31536000 ; includeSubDomains</pre>
		</div>
		<p style="margin-top: 20px;">
		Unfortunately, other subdomains such as shibboleth.nyu.edu remove HSTS by including the following header in responses:
		</p>
		<div class="indent">
			<pre class="code">Strict-Transport-Security: max-age=0</pre>
		</div>
		<p style="margin-top: 20px;">
		Combined with other configuration decisions, this meant that when a user would type nyu.edu in their browser,
		the initial request was sent in plaintext and therefore could be intercepted by an adversary.
		</p>
		<p>
		Note that NYU was already informed of this HSTS configuration behavior on 4 May 2021.
		</p>

		<!-------------------- END OF MAIN CONTENT -------------------->
<div type="margin: 0px auto;">            
</div>
        </div>
	</div>
</div>

<div id="copyright" class="container">
	<p><a  rel="license" href="http://creativecommons.org/licenses/by/4.0/" style="letter-spacing: normal;">
        Creative Commons Attribution 4.0 International License</a> | Design inspired by <a href="http://templated.co" rel="nofollow">TEMPLATED</a>.</p>
</div>
<script type="text/javascript">
/**
 * Mobile Menu
 */
 
(function ($) {
	function close_menu() {
		$('a#menu_button').removeClass('responsive-toggle-open');
		$('#menu_title').css('background', '');
		// So menu still works after being used, and window is resized
		$('.js #main-nav .menu').removeAttr('style');
	}
	var current = $('span.custom-mobile-menu-title').html();
	$('#main-nav').append('<a id="menu_button"></a>');
	$('#main-nav').prepend('<div id="menu_title">' + current + '</div>');
	$('a#menu_button, #menu_title').click(function (e) {
		e.stopPropagation();
		$('#menu_title').css('background', '#d7d5d5');
		$('.js #main-nav .menu').slideToggle(function () {
			if ($(this).is(':visible')) {
				$('a#menu_button').addClass('responsive-toggle-open');
			}
			else {
				close_menu();
			}
		});
	});
	// Close the mobile menu when clicked outside of it.
	$('html').click(function () {
		// Check if the menu is open, close in that case.
		if ($('a#menu_button').hasClass('responsive-toggle-open')) {
			$('.js #main-nav .menu').slideToggle(function () {
				close_menu();
			});
		}
	});
    
    // Catch click events outside menu on iOS: https://gist.github.com/danott/855078
    Modernizr.addTest('ipad', function () {
        return !!navigator.userAgent.match(/iPad/i);
    });
    Modernizr.addTest('iphone', function () {
        return !!navigator.userAgent.match(/iPhone/i);
    });
    Modernizr.addTest('ipod', function () {
        return !!navigator.userAgent.match(/iPod/i);
    });
    Modernizr.addTest('appleios', function () {
        return (Modernizr.ipad || Modernizr.ipod || Modernizr.iphone);
    });

    if (Modernizr.appleios) {
        $("html").addClass("clickable");
    }
})(jQuery);

</script>
</body>
</html>
